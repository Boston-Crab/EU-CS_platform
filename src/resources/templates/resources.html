{% extends "base2.html" %}

{% load staticfiles %}
{% load crispy_forms_tags %}
{% load i18n %}
{% load l10n %}

{% block title %}{{ block.super }}Resources{% endblock %}

{% block navbar-left %}
{% include "_navbar.html" with active_link="resources" %}
{% endblock %}

{% block page_title %}
Resources 
{% endblock page_title %}
{% block messages %}
{% if messages %}
{% for message in messages %}
<div class="main-content col-lg-10 col-md-9 col-sm-12 p-0 offset-lg-2 offset-md-3">
  <div class="alert alert-{{ message.tags }}">
    <a class="close" data-dismiss="alert">Ã—</a>
    {{ message|safe }}
  </div>
</div>
{% endfor %}
{% endif %}
{% endblock %}
{% block page_header %}
{% include "finder_resources.html" %}
{% endblock page_header %}
{%block list_of_items %}
      {% for rsc in resources %}
      <div class="col-lg-6 col-md-12 mb-4">
        <div class="card h-100">
								{% if rsc.image %} 
								<img class="img-fluid img-zoom" src="{{ rsc.image }}" />
								{% else %}
								<img class="img-fluid img-zoom" src="{% static 'site/img/proct.png' %}" />
								{% endif %}


          <div class="card-body">
            <h4 class="card-title">{{ rsc.name | truncatewords:10 }}</h4>
            <img class="card-img" style=" float: left; background-color: #fff; border-radius: 50%; border: 0px; width: 75px" src="{% static 'site/img/gdoc.png' %}">

						<p class="card-text">
        {% get_language_info_list for LANGUAGES as languages %}
        {% for language in languages %}
					{% if language.code == rsc.inLanguage %}
	 					<a class="badge badge-pill badge-success" href="/resources?language={{rsc.inLanguage}}">{{language.name_local}}</a>
					{% endif %}
				{% endfor %}
			{% for keyword in rsc.keywords.all %} <a class="badge badge-pill badge-secondary" href="/resources?keywords={{keyword}}">{{keyword}}</a>  {% endfor %}
</p>

            <p class="card-text">{{rsc.abstract |truncatewords:40 }}<br>

          </div>
					<div class="card-footer bg-white">
				 <div class="row">
					<div class="col-2">

              <div id="featured{{rsc.id}}" class="float-left">
                {% if user.is_staff %}
                  {% if rsc.id in featuredResources %}
                  <img onclick="setFeaturedRsc({{rsc.id}})" class="img-fluid mt-2" src="{% static 'site/img/icon_color.png' %}" />
                  {% else %}
                  <img onclick="setFeaturedRsc({{rsc.id}})" class="img-fluid mt-2" src="{% static 'site/img/icon_bw.png' %}" />
                  {% endif %}
                {% else %}
                  {% if rsc.id in featuredResources %}
                  <img class="img-fluid" src="{% static 'site/img/icon_color.png' %}" />
                  {% else %}
                  <img class="img-fluid" src="{% static 'site/img/icon_bw.png' %}" />
                  {% endif %}

                  {% endif %}

                        </div>
						</div>
						<div class="col-10">


 							<a class="btn btn-outline-primary float-right ml-2 mt-2" href="/resource/{{rsc.id}}" target="_blank">Read More</a>
            	<a class="btn btn-outline-secondary float-right ml-2 mt-2" href="{{rsc.url}}" target="_blank">Download</a>
        {% if user.is_authenticated %}
                  <div id="saved{{rsc.id}}">
                    {% if rsc.id in savedResources %}
                      <button type="button" class="btn btn-outline-primary float-right mt-2" onclick="setSavedResource({{rsc.id}},{{user.id}})">In my library</button>
                    {% else %}
                      <button type="button" class="btn btn-outline-secondary float-right mt-2" onclick="setSavedResource({{rsc.id}},{{user.id}})">Add to my library</button>
                    {% endif %}
                  </div>

                {% endif %}
	</div>
</div>


</div>
        </div>
      </div>
      {% endfor %}
{% endblock list_of_items %}

{% block scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.15.0/umd/popper.js"
integrity="sha256-7BfFV/dSvQT4pGBvRAIt6JDXsehb92DQqpGUndLCPQ4=" crossorigin="anonymous"></script>
<script
  src="https://cdn.rawgit.com/xcash/bootstrap-autocomplete/3de7ad37/dist/latest/bootstrap-autocomplete.js"></script>

<script>
	function setFeaturedRsc(idResource){
		var htmlId = "featured" + idResource;
        var request = $.ajax(
            {
                type: "POST",
                url: "{% url 'setFeaturedRsc' %}",
                data: {
                    "resource_id": idResource,
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                success: function (response) {
                    $("#"+htmlId).load(" #"+htmlId);
                }
            }
        );
    }

  function setSavedResource(idResource, idUser){
		var htmlId = "saved" + idResource;
        var request = $.ajax(
            {
                type: "POST",
                url: "{% url 'setSavedResource' %}",
                data: {
                    "resource_id": idResource,
					          "user_id": idUser,
              		  csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                success: function (response) {
                    $("#"+htmlId).load(" #"+htmlId);
                }
            }
        );
    }
</script>

<script>
  $('.basicAutoComplete').autoComplete(
    { minLength: 3 }
  );

  $("#keywords").blur(function () {
    $('#searchResources').submit();
  });

  $(function () {
    $('#language').on('change', function () {
      var language = $(this).val();
      $('#searchResources').submit();
    });
  });

  $("#license").blur(function () {
    $('#searchResources').submit();
  });
</script>
{% endblock scripts %} 
