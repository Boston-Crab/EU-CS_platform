{% extends "base_r2.html" %}
{% load staticfiles %}
{% load crispy_forms_tags %}
{% load i18n %}
{% load l10n %}
{% load reviews %}
{% block title %}{{ block.super }} :: Resources{% endblock %}
{% block navbar-left %}
{% include "_navbar.html" with active_link="resources" %}
{% endblock %}
{% block page_title %}
{% endblock page_title %}

{% block splash %}
<!--div class="jumbotron jumbotron-fluid jumbotron-resources mb-0">
  <div class="container">
    <h1 class="display-5 pb-0 pt-0 text-white mt-4">Resources</h1>
    <p class="lead text-light pb-2">Browse and search for citizen science resources, or add your own</p>
    <form  id="searchResources" action="{% if isTrainingResource %} {% url 'training_resources' %} {% else %}{% url 'resources' %} {% endif %}">
      <div class="input-group mb-3">
        <div class="input-group-prepend">
          <div class="input-group-text"><i class="fas fa-search"></i></div>
        </div>
        <input  type="text" id="keywords" name="keywords" autocomplete="off" value="{{filters.keywords}}" class="basicAutoComplete form-control form-control-lg"
        placeholder="Search for citizen science resources by title or keyword" data-url="resources_autocomplete/?language={{filters.language}}&theme={{filters.theme}}&category={{filters.category}}&approvedCheck={{filters.approvedCheck}}">

        <div class="input-group-append">
          <div class="input-group-text"><a href="#" data-toggle="modal" data-target="#resourcesinfo" ><i class="fas fa-info-circle"></i></a></div>
        </div>
      </div>
      </form>
    </div>
  </div!-->
  {% endblock splash %}
  {% block page_header %}
  {% include "finder_resources.html" %}
  {% endblock page_header %}
  {%block list_of_items %}
  {% include "modal_resources.html" %}
  <div class="container" id="content-1">
    <div class="row">
      {% include "resources_cards.html" %}
    </div>
  </div>


  {% endblock list_of_items %}

  {% block scripts %}
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.15.0/umd/popper.js"
  integrity="sha256-7BfFV/dSvQT4pGBvRAIt6JDXsehb92DQqpGUndLCPQ4=" crossorigin="anonymous"></script>
  <script
  src="https://cdn.rawgit.com/xcash/bootstrap-autocomplete/3de7ad37/dist/latest/bootstrap-autocomplete.js"></script>

  <script>
    function setApprovedRsc(idResource, approved) {
      var htmlId = "resource" + idResource;
      var request = $.ajax(
      {
        type: "POST",
        url: "{% url 'setApprovedRsc' %}",
        data: {
          "resource_id": idResource,
          "approved": approved,
          csrfmiddlewaretoken: '{{ csrf_token }}'
        },
        success: function (response) {
          window.location.reload(false);
        }
      }
      );
    }

    function setSavedResource(idResource, idUser, save) {
      var htmlId = "saved" + idResource;
      var request = $.ajax(
      {
        type: "POST",
        url: "{% url 'setSavedResource' %}",
        data: {
          "resource_id": idResource,
          "user_id": idUser,
          "save": save,
          csrfmiddlewaretoken: '{{ csrf_token }}'
        },
        success: function (response) {
          $("#" + htmlId).load(" #" + htmlId);
        }
      }
      );
    }

    function setHiddenResource(idResource, hidden) {
      var htmlId = "hidden" + idResource;
      var request = $.ajax(
      {
        type: "POST",
        url: "{% url 'setHiddenResource' %}",
        data: {
          "resource_id": idResource,
          "hidden": hidden,
          csrfmiddlewaretoken: '{{ csrf_token }}'
        },
        success: function (response) {
          window.location.reload(false);
        }
      }
      );
    }

    function setFeatured(idResource, featured){
      var htmlId = "featured" + idResource;
      var request = $.ajax(
      {
        type: "POST",
        url: "{% url 'setFeaturedResource' %}",
        data: {
          "resource_id": idResource,
          "featured": featured,
          csrfmiddlewaretoken: '{{ csrf_token }}'
        },
        success: function (response) {
          window.location.reload(false);
        }
      }
      );
    }

    $('.basicAutoComplete').autoComplete(
    { minLength: 3 }
    );

    $('.basicAutoComplete').on('autocomplete.select', function (evt, item) {
      $('#searchResources').submit();
    });

    $(function () {
      $('#language').on('change', function () {
        var language = $(this).val();
        $('#searchResources').submit();
      });
    });
    $(function () {
      $('#theme').on('change', function () {
        var topic = $(this).val();
        console.log(topic);
        $('#searchResources').submit();
      });
    });
    $(function () {
      $('#category').on('change', function () {
        var topic = $(this).val();
        $('#searchResources').submit();
      });
    });

    $("#license").blur(function () {
      $('#searchResources').submit();
    });

    $(function () {
      $('#approvedCheck').on('change', function () {
        var approvedCheck = $(this).val();
        $('#searchResources').submit();
      });
    });
    $(function () {
      $('#orderby').on('change', function () {
        var orderby = $(this).val();
        $('#searchResources').submit();
      });
    });

    $(document).ready(function () {
      $(".card").hover(
      function () {
        $(this).addClass('shadow-none').css('cursor', 'pointer');
      }, function () {
        $(this).removeClass('shadow-none');
      });
    });
  </script>
  {% endblock scripts %}
